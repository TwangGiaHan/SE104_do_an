<%- include("partials/header.ejs") %>
<div class="container">
  <%- include("partials/headerbar.ejs") %>
  <div class="rest">
    <!-- <form action="/dattiec" method="post"> -->
      <div class="infobar">
        <div class="textandinput">
          <div>Tên chú rể</div>
          <div>
            <input class="enter" name="groomName " required/>
          </div>
        </div>
        <div class="textandinput">
          <div>Ca</div>
          <div>
            <select class="enter" name = "ca" required>
                <option value="" disabled selected hidden>Chọn ca</option>
                <% for (const ca of caOptions) { %>
                  <option value="<%= ca.tenca%>"><%= ca.tenca %> (<%=ca.giobatdau %> - <%=ca.gioketthuc  %>)</option>
                <% } %>
            </select>
          </div>
        </div>
        <div class="textandinput">
          <div>Tên cô dâu</div>
          <div>
            <input class="enter" name="brideName" required/>
          </div>
        </div>
        <div class="textandinput">
          <div>Sảnh</div>
          <div>
            <select class="enter" required>
              <option value="" disabled selected hidden>Chọn sảnh</option>
              <% for (const sanh of sanhOptions) { %>
                <option value="<%= sanh.tensanh  %>"><%= sanh.tensanh  %></option>
              <% } %>
            </select>
          </div>
        </div>
        <div class="textandinput">
          <div>Điện thoại</div>
          <div>
            <input 
              class="enter" 
              type="tel"
              name="phone"
            />
          </div>
        </div>
        <div class="textandinput">
          <div>Số lượng bàn</div>
          <div>
            <input 
              class="enter" 
              type="number" min="1"
              name="tableQuantity"
            />
          </div>
        </div>
        <div class="textandinput">
          <div>Ngày đãi tiệc</div>
          <div>
            <input 
              class="enter" 
              type="date"  
              name="partyDate"
            />
          </div>
        </div>
        <div class="textandinput">
          <div>Tiền đặt cọc</div>
          <div>
            <input 
              class="enter" 
              type="number" min="1"
              name="deposit"
            />
          </div>
        </div>
        <div class="textandinput">
          <div>Số bàn dự trữ</div>
          <div>
            <input 
              class="enter" 
              type="number" min="1"
              name="tableCount"
            />
          </div>
        </div>
        <div class="textandinput">
          <div>Tham số tiền đặt cọc</div>
          <div>
            <input 
              class="enter" 
              type="number" step="0.01"
              name="parameter"
            />
          </div>
        </div>
      </div>
  
      <div class="changepassbtn">
        <form action="/userthemmonan" method="POST">
          <input
            class="passtxt"
            id="short1"
            class="headertext"
            type="submit"
            name="themma"
            value="Thêm món ăn"
          />
        </form>
      </div>

      <table class="table" id="tableMAdachon">
        <thead>
          <tr>
            <th>STT</th>
            <th>Tên món ăn</th>
            <th>Đơn giá</th>
            <th>Số lượng</th>
            <th>Thành tiền</th>
            <th>Ghi chú</th>
            <th>Xóa</th>
          </tr>
        </thead>
        <tbody>
          <% for (let i = 0; i < selectedItems.length; i++) { %>
            <tr>
              <td><%= i + 1 %></td>
              <td><%= selectedItems[i].name %></td>
              <td><%= selectedItems[i].price %></td>
              <td><%= selectedItems[i].quantity %></td>
              <td><%= selectedItems[i].totalPrice %></td>
              <td><%= selectedItems[i].note %></td>
              <td>
                <div class="hoverbutton">
                  <form action="/userxoamonan" method="POST"> <!-- Đổi đường dẫn tương ứng với route xử lý xóa món ăn -->
                    <input type="hidden" name="selectedItemId" value="<%= selectedItems[i].mamonan %>"> <!-- Thêm input ẩn để gửi id của món ăn cần xóa -->
                    <button type="submit" class="buttontext">Xóa</button>
                  </form>
                </div>
              </td>
            </tr>
          <% } %>
        </tbody>
      </table>
      
      <div class="changepassbtn">
        <form action="/userthemdichvu" method="POST">
          <input
            class="passtxt"
            id="short1"
            class="headertext"
            type="submit"
            name="themdv"
            value="Thêm dịch vụ"
          />
        </form>
      </div>

      <table class="table" id="tableDVdachon">
        <thead>
          <tr>
            <th>STT</th>
            <th>Tên dịch vụ</th>
            <th>Đơn giá</th>
            <th>Số lượng</th>
            <th>Thành tiền</th>
            <th>Ghi chú</th>
            <th>Xóa</th>
          </tr>
        </thead>
        <!--  -->
      </table>

      <div class="changepassbtn">
        <form action="/xacnhandattiec" method="POST">
          <input
            class="passtxt"
            id="short1"
            class="headertext"
            type="submit"
            name="xacnhan"
            value="Đặt Tiệc"
          />
        </form>
      </div>
    <!-- </form> -->
  </div>
</div>
<%- include("partials/footer.ejs") %>


<script>
  // Xử lý khi trang được load
  document.addEventListener('DOMContentLoaded', function() {
    renderSelectedItems();
  });

  // Hàm để đẩy dữ liệu từ mảng selectedItems vào table
  function renderSelectedItems() {
    const tableBody = document.getElementById('tableMAdachon').getElementsByTagName('tbody')[0];

    // Xóa nội dung cũ của table body
    tableBody.innerHTML = '';

    // Duyệt qua mảng selectedItems và thêm từng hàng vào table
    for (let i = 0; i < selectedItems.length; i++) {
      const item = selectedItems[i];
      const row = `
        <tr>
          <td>${i + 1}</td>
          <td>${item.name}</td>
          <td>${item.price}</td>
          <td>${item.quantity}</td>
          <td>${item.totalPrice}</td>
          <td><button onclick="deleteItem(${i})">Xóa</button></td>
        </tr>
      `;
      tableBody.insertAdjacentHTML('beforeend', row);
    }
  }

  // Hàm để xóa một món ăn khỏi danh sách selectedItems
  function deleteItem(index) {
    selectedItems.splice(index, 1); // Xóa phần tử tại index
    renderSelectedItems(); // Render lại table sau khi xóa
  }
</script>
